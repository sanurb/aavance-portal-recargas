<div class="min-h-screen flex flex-col items-center justify-center">
    <div class="bg-white p-10 rounded-lg shadow-md w-full max-w-sm">
        <div class="flex justify-center mb-6">
            <img src="../../public/pse-logo.png" alt="PSE logo placeholder image" class="rounded-full" width="100px" height="100px">
        </div>
        <h1 class="text-2xl font-medium text-center mb-6">Recarga con PSE</h1>
        <p class="text-sm text-center mb-4">Ingresa los datos de tu cuenta AAvance a recargar</p>
        <div class="mb-4">
            <label class="block text-sm font-medium mb-2" for="phone-number">Número de celular de la cuenta</label>
            <input type="text" id="phone-number" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-3" required>
        </div>
        <div class="mb-4">
            <label class="block text-sm font-medium mb-2" for="bank_code">Banco</label>
            <select id="bank_code"
                class="w-full p-2.5 text-gray-500 bg-white border-gray-300 rounded-md shadow-sm outline-none appearance-none focus:border-indigo-600">
                <option selected>Seleccione el banco</option>
            </select>
        </div>
        <div class="mb-4">
            <label class="block text-sm font-medium mb-2" for="amount">Monto a recargar</label>
            <input type="text" id="amount" class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-3" placeholder="Recarga mínima $10.000" required>
        </div>
        <button class="recargar-button w-full p-3 bg-gray-300 rounded-lg text-lg font-medium">RECARGAR</button>
    </div>
</div>

<script lang="js">
    const API_KEY = "ODE2ZGViYWIzZTI1Njc2MWJiYzI1YWMxZWNiMDNjNzA0MDBlZTIwM2QyN2QyNDQxZmUyMzFhZGQyMzE2ZTUyMzdkZmVhMzc4MGQxNmFkZjk5YWMxZWM5NDNiYjJiNmE1M2M0YmEzYzk0MzRlMmEwMjAzMDY3MDVmZDE2OGJkNTk=";
    function fetchBanks() {
        fetch("https://serviceregister.paymentsway.co/ClientAPI/ObtenerListadoBancos", {
            method: "GET",
            headers: {
                "Authorization": API_KEY,
                "Content-Type": "application/json"
            }
        })
        .then(response => response.json())
        .then(data => {
            const select = document.getElementById("bank_code");
            data.forEach(banco => {
                const option = document.createElement("option");
                option.value = banco.codigoach;
                option.text = banco.nombre;
                select.appendChild(option);
            });
        })
        .catch(error => console.error("Error al cargar bancos:", error));
    }

    document.addEventListener("DOMContentLoaded", fetchBanks);

    function extractUserDataFromLocalStorage() {
        const pin = localStorage.getItem("pin");
        const user = localStorage.getItem("user");
        const verificationCode = localStorage.getItem("verificationCode");
        return { pin, user, verificationCode };
    }

    const recargarButton = document.querySelector('.recargar-button');
    recargarButton.addEventListener('click', () => {
        const phone = document.getElementById('phone-number').value;
        const bank_code = document.getElementById('bank_code').value;
        const amount = document.getElementById('amount').value;
        const bank_name = document.querySelector('#bank_code option:checked').text;

        const { pin, user, verificationCode } = extractUserDataFromLocalStorage();

        const requestBody = {
            phone,
            bank_code,
            bank_name,
            amount,
            pin,
            idDocument: user,
            code: verificationCode
        };

        fetch('https://aavancepluginintegrations.paymentsway.co/recharge/withPse', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestBody)
        })
        .then(response => response.json())
        .then(data => {
            console.log('Recarga exitosa', data);
            // Aquí puedes agregar lógica adicional para manejar la respuesta
        })
        .catch(error => {
            console.error('Error al realizar la recarga', error);
        });
    });
</script>